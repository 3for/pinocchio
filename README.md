Source code from Microsoft vc project, and some special changes.

